<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Crop Disease Detector</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background: url("{{ url_for('static', filename='background.jpg') }}") no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: white;
    }
    .container {
      background: rgba(0,0,0,0.75);
      padding: 30px;
      border-radius: 15px;
      margin-top: 50px;
      max-width: 900px;
    }
    h1 { color: #00ff88; margin-bottom: 20px; }
    input[type="file"] { margin-bottom: 15px; }
    .uploaded-img { max-width: 300px; border-radius: 10px; margin-bottom: 20px; }
    .prediction-card {
      background: rgba(255,255,255,0.2);
      color: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .progress { height: 25px; background: rgba(255,255,255,0.3); }
    .progress-bar { transition: width 1s ease-in-out; }
    .suggestion-card {
      background: rgba(0,255,128,0.2);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container text-center">
    <h1>ðŸŒ± Smart Crop Disease Detector</h1>

    <a href="{{ url_for('history') }}" class="btn btn-info mb-3">View Prediction History</a>

    <!-- Upload form -->
    <form method="POST" enctype="multipart/form-data">
      <input type="file" name="leaf_image" class="form-control" required>
      <button type="submit" class="btn btn-success mt-2">Upload & Predict</button>
    </form>

    <!-- Uploaded image -->
    {% if file_path %}
      <h3 class="mt-4">Uploaded Image:</h3>
      <img src="{{ file_path }}" class="uploaded-img" alt="Uploaded Leaf">
    {% endif %}

    <!-- Predictions -->
    {% if predictions %}
      <h3>Predictions:</h3>
      {% for p in predictions %}
        {% set conf = p.confidence %}
        {% if conf >= 80 %}
          {% set bar_class = "bg-danger" %}
        {% elif conf >= 50 %}
          {% set bar_class = "bg-warning" %}
        {% else %}
          {% set bar_class = "bg-success" %}
        {% endif %}

        <div class="prediction-card text-start">
          <strong>{{ loop.index }}. {{ p.class }}</strong>
          <div class="progress mt-2">
            <div class="progress-bar {{ bar_class }}" role="progressbar" style="width:0%;">
              {{ "%.1f"|format(conf) }}%
            </div>
          </div>
        </div>
      {% endfor %}
    {% endif %}

    <!-- Suggestions -->
    {% if suggestion %}
      <div class="suggestion-card">
        <h4>ðŸŒ¿ Suggestions for {{ predictions[0].class }}:</h4>
        <p><strong>Precautions:</strong> {{ suggestion.precautions }}</p>
        <p><strong>Treatment:</strong> {{ suggestion.treatment }}</p>
      </div>
    {% endif %}
  </div>

  <script>
    window.onload = function() {
      const bars = document.querySelectorAll('.progress-bar');
      {% if predictions %}
        {% for i in range(predictions|length) %}
          bars[{{ i }}].style.width = "{{ predictions[i].confidence }}%";
        {% endfor %}
      {% endif %}
    };
  </script>
</body>
</html>
